[TOC]

# Description of database tables and fields

[Tables and Relations Diagram](images/gregory-table-relations-diagram.png)

## Articles

An Article is a published piece of knowledge, and is usually assigned the value of `science paper` for the `kind` column.

| Field Name          | Field Type      | Options/Comments                                                                | Description                                                                                             |
| ------------------- | --------------- | ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| article_id          | AutoField       | primary_key=True                                                                |                                                                                                         |
| title               | TextField       | blank=False, null=False, unique=True                                            |                                                                                                         |
| link                | URLField        | max_length=2000, blank=False, null=False                                        |                                                                                                         |
| doi                 | CharField       | max_length=280, blank=True, null=True                                           | Digital Object Identifier, used to avoid duplicates.                                                    |
| summary             | TextField       | blank=True, null=True                                                           | The abstract of the paper or full content of a news article.                                            |
| source              | ForeignKey      | Sources, on_delete=models.DO_NOTHING, db_column='source', blank=True, null=True |                                                                                                         |
| published_date      | DateTimeField   | blank=True, null=True                                                           | The date we get from the source or from the maintenance task that checks the DOI for extra information. |
| discovery_date      | DateTimeField   | auto_now_add=True                                                               | Date when we added the article to the database.                                                         |
| authors             | ManyToManyField | Authors, blank=True                                                             |                                                                                                         |
| categories          | ManyToManyField | Categories                                                                      |                                                                                                         |
| entities            | ManyToManyField | Entities                                                                        |                                                                                                         |
| relevant            | BooleanField    | blank=True, null=True                                                           | Manual annotation of the relevancy of the article to improve the quality of life for patients.          |
| ml_prediction_gnb   | BooleanField    | blank=True, null=True                                                           | Machine Learning Prediction with the Gausian Naive Bayes Model.                                         |
| ml_prediction_lr    | BooleanField    | blank=True, null=True                                                           | Machine Learning Prediction with the Logarithm Regression Model                                         |
| noun_phrases        | JSONField       | blank=True, null=True                                                           | Natural Language Processing to pick up the noun phrases in the title. Not used right now.               |
| sent_to_admin       | BooleanField    | blank=True, null=True                                                           | True if the article was sent to the admin for review.                                                   |
| sent_to_subscribers | BooleanField    | blank=True, null=True                                                           | True if the article was sent to the subscribers.                                                        |
| kind                | CharField       | choices=KINDS, max_length=50, default='science paper'                           | Not used right now. Possible values are `science paper` and `news article`.                             |
| access              | CharField       | choices=ACCESS_OPTIONS, max_length=50, default=None, null=True                  | Indicates if the article is open access or restricted.                                                  |
| publisher           | CharField       | max_length=150, blank=True, null=True, default=None                             | Publisher of the Journal                                                                                |
| container_title     | CharField       | max_length=150, blank=True, null=True, default=None                             | Journal Title                                                                                           |
| crossref_check      | DateTimeField   | blank=True, null=True                                                           | Date and time when we last checked crossref.org for up to date information.                             |
| takeaways           | TextField       | blank=True, null=True                                                           | Extraction of key takeaways from the summary / abstract.                                                |

## Authors

| Field Name  | Field Type    | Options/Comments                                   | Description                                                                        |
| ----------- | ------------- | -------------------------------------------------- | ---------------------------------------------------------------------------------- |
| author_id   | AutoField     | primary_key=True                                   | Primary key                                                                        |
| family_name | CharField     | max_length=150, blank=False, null=False            |                                                                                    |
| given_name  | CharField     | max_length=150, blank=False, null=False            |                                                                                    |
| ORCID       | CharField     | max_length=150, blank=True, null=True, unique=True | The URL for the author profile. Example: https://orcid.org/0000-0003-3045-0304     |
| country     | CountryField  | blank=True, null=True                              | Taken from the ORCID profile, empty most of the times. Does not equal affiliation. |
| orcid_check | DateTimeField | blank=True, null=True                              | Date of when we last checked ORCID to avoid overloading them with requests         |

## Categories

A category is a medicine, a treatment, or special area of research. Categories are applied to both clinical trials and articles and allow us to look at both side by side. In this example we can see how much research was published around Autologous Hematopoietic Stem Cell Transplantation (aHSCT) and how many clinical trials were done in the same period of time. https://gregory-ms.com/categories/ahsct/

| Field Name           | Field Type | Options/Comments                                                                                                                                   | Description                                                                            |
| -------------------- | ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- |
| category_id          | AutoField  | primary_key=True                                                                                                                                   |                                                                                        |
| category_description | TextField  | blank=True, null=True                                                                                                                              | Annotation of the description of the drug and reason for including it in the database. |
| category_name        | CharField  | max_length=200, blank=True, null=True                                                                                                              |                                                                                        |
| category_slug        | SlugField  | blank=True, null=True, unique=True                                                                                                                 | Used to build the API endpoint                                                         |
| category_terms       | ArrayField | CharField(max_length=100), default=list, verbose_name='Terms to include in category (comma separated)', help_text="Add terms separated by commas." | List of search terms for that category                                                 |

## Entities

Not used right now, the initial idea was to identify entities based on an ontology.

| Field Name | Field Type | Options/Comments |
| ---------- | ---------- | ---------------- |
| entity     | TextField  |                  |
| label      | TextField  |                  |

## Sources

A source of data can be RSS, WebScrapping, manual Imports of bulk data, or manual addition of a new article.

RSS sources are processed automatically. Each source must indicate if it is meant for clinical trials or science papers. 

| Field Name  | Field Type   | Options/Comments                                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ----------- | ------------ | -------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| source_id   | AutoField    | primary_key=True                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| source_for  | CharField    | choices=TABLES, max_length=50, default='science paper'   | Pipeline to use for this source. Either `science paper` or `trials`.                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| name        | TextField    | blank=True, null=True                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| link        | TextField    | blank=True, null=True                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| language    | TextField    |                                                          | Just for reference right now. Usually `en`.                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| subject     | ForeignKey   | Subject, on_delete=models.PROTECT, null=True, blank=True | Related to a specific subject of research.                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| method      | CharField    | choices=METHODS, max_length=10, default='rss'            | Current values "manual", "xml import", "scrape", "rss".                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ignore_ssl  | BooleanField | default=False                                            | The website for the [European Clinical Trials Register](https://www.clinicaltrialsregister.eu/ctr-search/rest/feed/bydates?query=multiple+AND+sclerosis) had a faulty SSL configuration, we added this field to bypass that check.                                                                                                                                                                                                                                                                    |
| description | TextField    | blank=True, null=True                                    | Used when we need to include information about how the source was configured. For example, the value for PubMed is this:<br />WEB LINK:<br/>https://pubmed.ncbi.nlm.nih.gov/?term=((((Multiple+Sclerosis)+OR+(autoimmune+encephalomyelitis))+OR+(encephalomyelitis))+OR+(immune+tolerance))+OR+(myelin)&sort=pubdate&size=200<br/><br/>RSS LINK:<br/>https://pubmed.ncbi.nlm.nih.gov/rss/search/1DC34RKGsqmN2iX6sLmdTBBsyJ7Rwk22eDT5shXuU12f7ALkev/?limit=100&utm_campaign=pubmed-2&fc=20221030163514 |

## Subject

Groundwork so that we can one day use the same Gregory install for multiple fields of research. Right now the only subject is Multiple Sclerosis

| Field Name   | Field Type | Options/Comments                       |
| ------------ | ---------- | -------------------------------------- |
| subject_name | CharField  | max_length=50, blank=False, null=False |
| description  | TextField  | blank=True, null=True                  |

## Trials

| Field Name                    | Field Type        | Options/Comments                                                                  | World Health Organisation match | Description                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ----------------------------- | ----------------- | --------------------------------------------------------------------------------- | ------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| trial_id                      | AutoField         | primary_key=True                                                                  |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| discovery_date                | DateTimeField     | blank=True, null=True                                                             |                                 | Date when the trial was added to the database                                                                                                                                                                                                                                                                                                                                                                                           |
| title                         | TextField         | blank=False, null=False, unique=True                                              |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| summary                       | TextField         | blank=True, null=True                                                             |                                 | Summary taken from the source                                                                                                                                                                                                                                                                                                                                                                                                           |
| link                          | URLField          | max_length=2000, blank=False, null=False                                          | web_address                     | Original link.                                                                                                                                                                                                                                                                                                                                                                                                                          |
| published_date                | DateTimeField     | blank=True, null=True                                                             | Date_registration               |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| source                        | ForeignKey        | 'Sources', on_delete=models.DO_NOTHING, db_column='source', blank=True, null=True |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| relevant                      | BooleanField      | blank=True, null=True                                                             |                                 | Not used right now, meant to signal new treatments                                                                                                                                                                                                                                                                                                                                                                                      |
| sent                          | BooleanField      | blank=True, null=True                                                             |                                 | Unsure if it can be removed.                                                                                                                                                                                                                                                                                                                                                                                                            |
| sent_to_subscribers           | BooleanField      | blank=True, null=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| sent_to_admin                 | BooleanField      | blank=True, null=True, default=False                                              |                                 | True if it was sent to the admin                                                                                                                                                                                                                                                                                                                                                                                                        |
| sent_real_time_notification   | BooleanField      | blank=True, null=True, default=False                                              |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| categories                    | ManyToManyField   | Categories, blank=True                                                            |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| identifiers                   | JSONField         | blank=True, null=True                                                             |                                 | Right now there isn’t a single identifier number for clinical trials. Each registry uses its own format and we are saving them all as a jsonb column. There is a plan to establish a [Universal Trial Number](https://www.who.int/clinical-trials-registry-platform/unambiguous-trial-identification/the-universal-trial-number-(utn)#:~:text=The%20aim%20of%20the%20Universal,the%20history%20of%20the%20trial.) for the WHO registry. |
| history                       | HistoricalRecords |                                                                                   |                                 | We are keeping track of changes to the clinical trials but are not using this information right now.                                                                                                                                                                                                                                                                                                                                    |
| **WHO fields start here**     | ---               | ---                                                                               | ---                             | ---                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| export_date                   | DateTimeField     | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| internal_number               | CharField         | max_length=20, null=True, blank=True                                              |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| last_refreshed_on             | DateField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| scientific_title              | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| primary_sponsor               | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| retrospective_flag            | CharField         | max_length=3, null=True, blank=True                                               |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| date_registration             | DateField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| source_register               | CharField         | max_length=50, null=True, blank=True                                              |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| recruitment_status            | CharField         | max_length=50, null=True, blank=True                                              |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| other_records                 | CharField         | max_length=3, null=True, blank=True                                               |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| inclusion_agemin              | CharField         | max_length=20, null=True, blank=True                                              |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| inclusion_agemax              | CharField         | max_length=20, null=True, blank=True                                              |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| inclusion_gender              | CharField         | max_length=100, null=True, blank=True                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| date_enrollement              | DateField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| target_size                   | CharField         | max_length=100, null=True, blank=True                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| study_type                    | CharField         | max_length=150, null=True, blank=True                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| study_design                  | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| phase                         | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| countries                     | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| contact_firstname             | CharField         | max_length=150, null=True, blank=True                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| contact_lastname              | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| contact_address               | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| contact_email                 | EmailField        | max_length=500, null=True, blank=True                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| contact_tel                   | CharField         | max_length=150, null=True, blank=True                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| contact_affiliation           | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| inclusion_criteria            | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| exclusion_criteria            | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| condition                     | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| intervention                  | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| primary_outcome               | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| secondary_outcome             | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| secondary_id                  | CharField         | max_length=150, null=True, blank=True                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| source_support                | TextField         | max_length=100, null=True, blank=True                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ethics_review_status          | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ethics_review_approval_date   | DateField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ethics_review_contact_name    | EmailField        | max_length=500, null=True, blank=True                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ethics_review_contact_address | TextField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ethics_review_contact_phone   | CharField         | max_length=50, null=True, blank=True                                              |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ethics_review_contact_email   | EmailField        | max_length=500, null=True, blank=True                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| results_date_completed        | DateField         | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| results_url_link              | URLField          | null=True, blank=True                                                             |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                         |
